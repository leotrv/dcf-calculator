openapi: 3.0.0
info:
  title: DCF Analysis API
  version: 1.0.0
  description: REST API for Discounted Cash Flow (DCF) valuation analysis
  contact:
    name: DCF-Agent Project
  license:
    name: MIT

servers:
  - url: http://localhost:8000
    description: Local development server
  - url: https://api.example.com
    description: Production server (placeholder)

paths:
  /dcf/calculate:
    post:
      summary: Calculate DCF Valuation
      description: |
        Performs Discounted Cash Flow analysis using the Gordon Growth Model.
        Returns Enterprise Value and Equity Value calculations.
      operationId: calculateDCF
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DCFRequest'
            examples:
              baseline:
                summary: Baseline 5-year forecast (FCF in billions, rates in percent)
                value:
                  starting_fcf: 1.0
                  fcf_growth_rate: 5.0
                  years: 5
                  discount_rate: 8.0
                  terminal_growth_rate: 3.0
                  net_debt: 0.2
              single_year:
                summary: Single-year forecast
                value:
                  starting_fcf: 0.90909
                  fcf_growth_rate: 10.0
                  years: 1
                  discount_rate: 10.0
                  terminal_growth_rate: 2.0
                  net_debt: 0.0
              with_custom_tv:
                summary: With pre-calculated Terminal Value (provide terminal value in billions)
                value:
                  starting_fcf: 1.0
                  fcf_growth_rate: 5.0
                  years: 3
                  discount_rate: 10.0
                  terminal_growth_rate: 3.0
                  net_debt: 1.0
                  terminal_value: 15.0
      responses:
        '200':
          description: DCF calculation successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DCFResponse'
              examples:
                success:
                  summary: Successful calculation (values in billions)
                  value:
                    enterprise_value: 5.23456789
                    equity_value: 3.23456789
                    discounted_fcfs: [0.90909, 0.90826, 0.90158, 0.88900, 0.86844]
                    discounted_terminal_value: 9.29486205
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                wacc_le_g:
                  summary: WACC not greater than g
                  value:
                    error: "WACC must be strictly greater than terminal growth rate g. Current: WACC=0.05, g=0.06"
                    error_code: "WACC_LE_G"
                    details:
                      wacc: 0.05
                      g: 0.06
                empty_fcf:
                  summary: FCF array empty
                  value:
                    error: "Free Cash Flow array cannot be empty. At least one FCF value required."
                    error_code: "EMPTY_FCF_ARRAY"
                    details: null
                forecast_out_of_range:
                  summary: Forecast period too long
                  value:
                    error: "Forecast period must be between 1 and 30 years. Provided: 35 years"
                    error_code: "FORECAST_PERIOD_OUT_OF_RANGE"
                    details:
                      forecast_years: 35
        '422':
          description: Unprocessable entity (JSON type error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: array
                    items:
                      type: object

components:
  schemas:
    DCFRequest:
      type: object
      required:
        - starting_fcf
        - fcf_growth_rate
        - years
        - discount_rate
      properties:
        starting_fcf:
          type: number
          format: float
          description: Starting free cash flow (last historical year). Units: billions.
          example: 72.764
        fcf_growth_rate:
          type: number
          format: float
          description: Forecast FCF growth rate expressed in percent (e.g., 8.0 = 8%).
          example: 8.0
        years:
          type: integer
          description: Number of forecast years (1-30).
          minimum: 1
          maximum: 30
          example: 10
        discount_rate:
          type: number
          format: float
          description: Discount rate / WACC expressed in percent (e.g., 8.0 = 8%). Must be > 0 and greater than `terminal_growth_rate` if provided.
          example: 8.0
          exclusiveMinimum: 0
        terminal_growth_rate:
          type: number
          format: float
          nullable: true
          description: Terminal (perpetuity) growth rate expressed in percent (e.g., 3.0 = 3%). If omitted, no terminal value will be used.
          example: 3.0
          minimum: 0
        net_debt:
          type: number
          format: float
          description: Net debt in billions. Positive = net debt; negative = net cash.
          example: -54.3
        terminal_value:
          type: number
          format: float
          nullable: true
          description: Optional pre-calculated Terminal Value (in billions). If provided, the service will use this value instead of calculating TV.
          example: 15.0

    DCFResponse:
      type: object
      required:
        - enterprise_value
        - equity_value
        - discounted_fcfs
        - discounted_terminal_value
      properties:
        enterprise_value:
          type: number
          format: float
          description: Enterprise Value = sum of discounted cash flows + discounted terminal value. Units: billions. Rounded to 2 decimals on serialization.
          example: 2.2265784
        equity_value:
          type: number
          format: float
          description: Equity Value = Enterprise Value - Net Debt. Units: billions. Rounded to 2 decimals on serialization.
          example: 2.2808784
        discounted_fcfs:
          type: array
          items:
            type: number
            format: float
          description: Present value of each forecasted FCF (units: billions). Array length equals `years`. Each element rounded to 2 decimals on serialization.
          example: [0.072764, 0.072764, 0.072764, 0.072764, 0.072764]
        discounted_terminal_value:
          type: number
          format: float
          description: Present value of Terminal Value = TV / (1 + discount_rate)^n. Units: billions. Rounded to 2 decimals on serialization.
          example: 1.4989384

    ErrorResponse:
      type: object
      required:
        - error
        - error_code
      properties:
        error:
          type: string
          description: Human-readable error message
          example: "WACC must be strictly greater than terminal growth rate g. Current: WACC=0.05, g=0.06"
        error_code:
          type: string
          enum:
            - EMPTY_FCF_ARRAY
            - NEGATIVE_FCF_VALUE
            - FORECAST_PERIOD_OUT_OF_RANGE
            - INVALID_WACC
            - INVALID_G
            - WACC_LE_G
            - INVALID_NETDEBT
          description: Machine-readable error code for programmatic handling
          example: "WACC_LE_G"
        details:
          type: object
          nullable: true
          description: Optional additional details depending on error type
          example:
            wacc: 0.05
            g: 0.06

tags:
  - name: DCF Analysis
    description: Discounted Cash Flow valuation calculations
